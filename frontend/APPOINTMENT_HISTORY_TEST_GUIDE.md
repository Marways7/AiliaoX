# 挂号历史功能测试指南

## 问题诊断结果

### 根本原因
数据库初始化脚本 (`backend/scripts/seed.ts`) **没有创建挂号记录**，导致用户访问挂号历史页面时看到空白。

### 已修复内容
1. ✅ 创建了测试挂号数据脚本 (`backend/scripts/create-test-appointments.ts`)
2. ✅ 已成功创建6条测试挂号记录（不同状态、日期、科室）
3. ✅ 后端API验证通过（筛选、分页功能正常）

---

## 快速测试步骤

### 1. 登录系统
```
用户名: zhangsan
密码: Doctor123!
```

### 2. 访问挂号历史页面
```
http://localhost:5173/appointments/history
```

### 3. 验证数据显示

应该看到 **6条挂号记录**，包含以下信息：

**表头**：
- 挂号号码
- 患者姓名
- 科室
- 医生
- 就诊日期
- 时间段
- 优先级
- 状态

**示例记录**：
1. DEP00120251001000001 - 李小花 - 外科 - 李四 - 2025-10-01 - 上午 - 普通 - 待就诊
2. DEP00120251001000002 - 测试患者E2E - 外科 - 李四 - 2025-10-01 - 下午 - 紧急 - 已完成
3. DEP00220250930000001 - 李小花 - 儿科 - 张三 - 2025-09-30 - 上午 - 普通 - 已完成
4. DEP00320251001000001 - 李小花 - 内科 - 李四 - 2025-10-01 - 下午 - 急诊 - 待就诊
5. DEP2025100100001 - 测试患者MCP - 内科 - 张三 - 2025-10-01 - 上午 - 普通 - 已取消
6. DEP2025100100002 - 测试患者MCP - 内科 - 张三 - 2025-10-01 - 上午 - 普通 - 待就诊

### 4. 测试筛选功能

#### 状态筛选
1. 选择"待就诊" → 应显示 **3条** 记录
2. 选择"已完成" → 应显示 **2条** 记录
3. 选择"已取消" → 应显示 **1条** 记录
4. 选择"全部状态" → 应显示 **6条** 记录

#### 日期筛选
1. 开始日期: 2025-10-01 → 应显示 **5条** 记录（今天）
2. 开始日期: 2025-09-30，结束日期: 2025-09-30 → 应显示 **1条** 记录（昨天）

### 5. 测试分页功能
- 当前数据只有6条，全部显示在第1页
- 分页信息应显示："第 1 页，共 1 页"
- 上一页按钮应该是禁用状态
- 下一页按钮应该是禁用状态

---

## 已知字段映射

### 后端返回的时间段枚举值
- `MORNING` → 显示为 "上午 08:00-12:00"
- `AFTERNOON` → 显示为 "下午 14:00-18:00"
- `EVENING` → 显示为 "晚上 18:00-20:00"

### 状态徽章颜色
- 待就诊 (PENDING) → 黄色警告徽章
- 已确认 (CONFIRMED) → 蓝色信息徽章
- 已完成 (COMPLETED) → 绿色成功徽章
- 已取消 (CANCELLED) → 灰色次要徽章
- 未到诊 (MISSED) → 红色错误徽章

### 优先级徽章
- 普通 (NORMAL) → 蓝色小徽章
- 紧急 (URGENT) → 黄色小徽章
- 急诊 (EMERGENCY) → 红色小徽章

---

## 如果遇到问题

### 问题1: 页面显示"暂无挂号记录"
**解决方案**：重新运行测试数据脚本
```bash
cd backend
npx tsx scripts/create-test-appointments.ts
```

### 问题2: 筛选后无数据
**检查项**：
1. 打开浏览器开发者工具 (F12)
2. 查看Network标签页
3. 找到 `/api/v1/appointments` 请求
4. 检查请求参数和响应数据

### 问题3: 时间段显示异常
**预期行为**：
- 如果后端返回`MORNING`，前端应显示"上午 08:00-12:00"
- 如果显示原始值（如"MORNING"），则前端映射逻辑有问题

### 问题4: 字段显示为undefined
**检查项**：
- 打开Console标签页查看JavaScript错误
- 检查API响应数据结构是否包含patient、doctor、department嵌套对象

---

## 后端API测试命令（可选）

如果需要直接测试后端API：

```bash
# 1. 登录获取token
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"zhangsan","password":"Doctor123!"}'

# 2. 获取所有挂号（替换YOUR_TOKEN）
curl -X GET "http://localhost:3000/api/v1/appointments?page=1&limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 3. 筛选待就诊挂号
curl -X GET "http://localhost:3000/api/v1/appointments?status=PENDING" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 4. 筛选已完成挂号
curl -X GET "http://localhost:3000/api/v1/appointments?status=COMPLETED" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 验证清单

请在浏览器中逐项验证以下功能，在测试通过的项目前打勾：

### 基础功能
- [ ] 页面正常加载，无JavaScript错误
- [ ] 显示6条挂号记录
- [ ] 每条记录的所有字段都正确显示（无undefined）
- [ ] 挂号号码、患者姓名、科室、医生字段完整
- [ ] 就诊日期格式正确（YYYY-MM-DD）
- [ ] 时间段显示中文标签（如"上午 08:00-12:00"）
- [ ] 状态徽章显示正确颜色和文字
- [ ] 优先级徽章显示正确

### 筛选功能
- [ ] 状态下拉框包含所有选项（全部/待就诊/已确认/已完成/已取消/未到诊）
- [ ] 选择"待就诊"显示3条记录
- [ ] 选择"已完成"显示2条记录
- [ ] 选择"已取消"显示1条记录
- [ ] 日期筛选功能正常工作
- [ ] "应用筛选"按钮功能正常
- [ ] "重置"按钮清空所有筛选条件

### 分页功能
- [ ] 显示正确的页码信息（第1页，共1页）
- [ ] 显示正确的总记录数（共6条记录）
- [ ] 上一页按钮正确禁用
- [ ] 下一页按钮正确禁用

### 用户体验
- [ ] 加载状态动画显示正常
- [ ] 表格hover效果正常
- [ ] 响应式布局在不同屏幕尺寸下正常
- [ ] 徽章颜色与状态语义匹配

---

## 预期最终效果

挂号历史页面应该：
1. ✅ 正常显示所有挂号记录
2. ✅ 支持按状态筛选
3. ✅ 支持按日期范围筛选
4. ✅ 分页控件正常工作
5. ✅ 所有字段正确映射显示
6. ✅ 用户体验流畅，无明显瑕疵

---

生成时间：2025-10-01
验证人：Claude Code项目经理
状态：待用户验证
